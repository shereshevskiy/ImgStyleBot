# <center>PET-PROJECT
# <center>Стилизация изображений в телеграм-боте

## Имя телеграм-бота: *@ImgStyleBot*
### Ссылка на бота: https://t.me/ImgStyleBot
### Гитхаб репозиторий проекта: https://github.com/shereshevskiy/ImgStyleBot
### Автор: Дмитрий Шерешевский, [LinkedIn](https://www.linkedin.com/in/dmitry-shereshevskiy/)
## <center>Описание проекта

### Общая информация
1. Телеграм бот стилизует картинки, которые ему для этого передаются, в соответствие с образцом стиля. 
   Образец стиля можно передать свой или использовать предустановленные алгоритмы или образцы стилей   

### Функционал
2. Описание функционала:
    - Быстрая стилизация, примерно до 1 минуты, с предустановленными 4-мя стилями художников - Моне, Сезанн, Укиё-э, Вангог
    - Медленная стилизация (3-5 или даже до 10 минут). Здесь можно передать в качестве стиля свою картинку-образец
    - **ДОПОЛНИТЕЛЬНАЯ ФУНКЦИОНАЛЬНОСТЬ:** Для медленной стилизации добавлено 19 предустановленных образцов стилей - 
      Андеграунд, Авангардизм, Импрессионизм и т.д.
    - списки предустановленных стилей можно вывести по соответствующим командам бота
    - список всех доступных команд можно вывести по команде **/help**
    - стилизовать можно в ходе диалога с подсказками от бота, этот диалог включает все возможные сценарии стилизации
    - также можно по соответствующим командам практически в любой момент задавать исходные картинки и стили, в любом 
      порядке и запускать стилизацию отдельно (то есть не в ходе диалога). Это удобно, когда нужно на одной картинке попробовать несколько стилей или, 
      наоборот, один стиль на нескольких картинках. Если исходная картинка или стиль уже есть — повторно вводить не 
      надо, можно сразу запустить выбранный вариант стилизации
    - все образцы стилей и стилизованные картинки подписываются названием стиля

### Алгоритмы
3. Алгоритмы стилизации реализованы на базе **нейронных сетей**
4. Стилизация делается **двумя** способами:   
    **а)** медленный способ, реализованный на базе нейросетевого алгоритма **Style Transfer (NST)**.
   Для этого боту нужно отправить две картинки — стилизуемую картинку 
   (контент) и картинку с образцом стиля    
   - для стилизации посредством **Style Transfer** алгоритма можно также использовать **предустановленные образцы стилей**, 
     которые добавлены в качестве реализации **дополнительной функциональности**      
     
    **б)** быстрый способ, реализованный на базе нейросетевого алгоритма **CycleGAN**

5. Для алгоритма **Style Transfer** в качестве **базовой сети** использована предобученная сеть архитектуры **VGG19** 
   из библиотеки **torchvision**. Полная версия этой сети занимает около **550 мб**. Непосредственно в алгоритме 
   задействовано только первые **18** слоев этой сетки (всего их **37**). 
   Поэтому для оптимизации использования памяти, что особенно актуально для бесплатного тарифа Heroku, 
   были удалены неиспользуемые глубокие слои. В результате потребовалось всего около **9 мб** памяти

### Деплой и фреймворки
6. **Деплой** бота реализован на сервере **Heroku**, в настоящее время - на бесплатном тарифе
7. Для общения с ботом реализован дружественный интерфейс на фреймворке **pyTelegramBotAPI**
8. Нейросетевые алгоритмы реализованы на фреймворке **pytorch**

### Структура кода
9. Диалог бота реализован в модуле **bot**
10. Алгоритмы стилизации **CycleGAN** и **NST** реализованы в соответствующих классах в модуле **models**
11. Пароли и токены задаются через переменные окружения (используется переменная **BOT_TOKEN**)
12. Для управления параметрами созданы конфигурационные и **settings**-файлы в соответствующих модулях

### Обучение нейросетей
13. Для алгоритмов **быстрой стилизации** с помощью нейросети **CycleGAN** было обучено **четыре** модели 
   на датасетах из картин художников:
    - **Моне**, ноутбук с обучением модели [здесь](https://colab.research.google.com/drive/14GVtbpuUTPQzVbTM_OxKbqH4vNGB9X_V?usp=sharing)
    - **Сезанн**, ноутбук с обучением модели [здесь](https://colab.research.google.com/drive/15ZVAUcJvTqL7ry4W9NKn2RINrS5mhpOr?usp=sharing)
    - **Укиё-э**, ноутбук с обучением модели [здесь](https://colab.research.google.com/drive/1qDywo9sTxM625bgida4guqmbbQIqWnel?usp=sharing)
    - **Вангог**, ноутбук с обучением модели [здесь](https://colab.research.google.com/drive/1pDPV0p2_VXVHEdYBWQltJt8VXUDP_XFW?usp=sharing)
14. Обучение проводилось на сервисе **Google Colab Pro**